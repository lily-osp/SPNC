**Document 3: UI/UX Design Document**

**Project:** ESP32 Scientific Programmable Networked Calculator (SPNC)
**Version:** 0.1
**Date:** 2023-10-27

**1. Introduction**

This document describes the user interface (UI) layout, navigation principles, and user experience (UX) goals for the SPNC, utilizing the 256x128 pixel monochrome OLED display and the 8x8 matrix keyboard.

**2. General Principles**

*   **Clarity:** Information should be presented clearly and unambiguously. Avoid clutter.
*   **Responsiveness:** UI must respond immediately to key presses. Feedback for actions (calculations, saves, network calls) should be provided.
*   **Consistency:** Navigation patterns (e.g., use of MODE, ENTER, ESC, UP/DOWN keys) should be consistent across different modes.
*   **Readability:** Use clear fonts. Leverage the larger display height for better spacing and potentially larger fonts where appropriate.
*   **Context:** Utilize the extra screen space to provide relevant context (e.g., view variables while calculating, see file info in browser).

**3. Font Usage**

*   Primary Font: A clear, fixed-width or proportional sans-serif font (e.g., 8px height minimum for main text).
*   Status Bar Font: May use the same font or a slightly smaller variant if needed.
*   Larger Fonts: Consider using larger fonts (e.g., 12-16px height) for displaying primary results or prominent messages, if performance and memory allow. Font choice might be configurable later.

**4. Screen Layout Structure (256x128)**

The screen is conceptually divided into zones:

*   **Zone 1: Status Bar (Top ~10 pixels):** Persistent across most modes.
*   **Zone 2: Primary Interaction Area (Variable Height):** Location for calculator input, current editor line, file selection highlight, main prompt.
*   **Zone 3: Main Content/Output Area (Largest Area):** Displays calculation results, script listings, file browser content, API results, multi-line script output. Should be scrollable using UP/DOWN keys when content exceeds the area.
*   **Zone 4: Context/Info Area (Optional, Bottom or Side):** Could display current variable values, history snippets, help text, depending on the mode and available space.

**5. Status Bar Layout (Zone 1)**

*(Approximate Horizontal Positions)*

*   `[ 0-50 ]`: Current Mode (e.g., "CALC", "SCRIPT", "FILE", "WIFI", "I2C")
*   `[ 55-85 ]`: Angle Mode ("DEG", "RAD", "GRAD")
*   `[ 90-120 ]`: Modifier State ("SHIFT", "FN", "ALPHA") - Only shown when active.
*   `[ ~180-210 ]`: Script Name (`script.py` - if in SCRIPT mode)
*   `[ 220-255 ]`: WiFi Status Icon (e.g., Bars: None, Low, Med, High) / Network Activity Indicator

**6. Mode-Specific Layouts & Navigation**

*   **6.1. Calculator Mode (CALC)**
    *   **Zone 2:** Displays the current input expression being typed (potentially wrapping/scrolling horizontally). A cursor indicates the insertion point.
    *   **Zone 3:** Displays the result of the last calculation ('=' pressed). May show previous calculations (history scrolling up).
    *   **Zone 4 (Optional):** Could show the value of 'Ans' and maybe 2-3 other key variables (A, B, C?).
    *   **Navigation:** Numbers/Operators append to input. '=' evaluates. AC clears all. CE backspaces. STO/RCL keys initiate variable operations. MODE key cycles to other modes.

*   **6.2. Script Edit Mode (SCRIPT-EDIT)**
    *   **Zone 2:** Displays the *current line* being edited, with a cursor. Edits happen here.
    *   **Zone 3:** Displays a scrollable view of the script lines (with line numbers). The currently selected line (via UP/DN) is highlighted.
    *   **Zone 4 (Optional):** Could show script filename, total lines, cursor position (row/col).
    *   **Navigation:** UP/DOWN scrolls through lines in Zone 3 and loads the selected line into Zone 2 for editing. ENTER confirms changes to the line in Zone 2 and moves to the next line. Alpha/Symbol keys edit in Zone 2. Specific keys for SAVE, RUN, LOAD (enter FILE mode). ESC might exit editor (prompt to save?).

*   **6.3. File Browser Mode (FILE-BROWSE)**
    *   **Context:** Entered via LOAD/SAVE commands, or dedicated file mode key. Shows files in `/sd/scripts/` or `/sd/data/`.
    *   **Zone 2:** Shows the currently selected filename.
    *   **Zone 3:** Displays a scrollable list of files in the current directory. Selection highlighted.
    *   **Zone 4 (Optional):** Shows file size, modification date (if feasible).
    *   **Navigation:** UP/DOWN moves selection. ENTER performs the action (Load, Save with this name, Run, View?). ESC/BACK goes back or cancels. Specific keys might allow creating/deleting files.

*   **6.4. Script Run Mode (SCRIPT-RUN)**
    *   **Zone 2:** May show the currently executing line number or prompts from `prompt_xxx` API calls.
    *   **Zone 3:** Displays output generated by the script (`calculator_api.display`). Scrollable.
    *   **Zone 4:** Might show execution status ("Running", "Paused", "Waiting Input").
    *   **Navigation:** Input keys active only during `prompt_xxx` calls. A specific key (e.g., ESC, AC) might be assigned to interrupt/stop script execution (needs confirmation prompt).

*   **6.5. API Interaction Modes (API-WIKI, API-LLM)**
    *   **Zone 2:** Displays the prompt (e.g., "Wiki Search:", "LLM Prompt:") and the user's typed input.
    *   **Zone 3:** Displays the multi-line response received from the API. Scrollable.
    *   **Zone 4:** Shows status ("Fetching...", "Processing...", "Error").
    *   **Navigation:** Alpha/Symbol keys for input. ENTER submits the query. ESC/BACK cancels or returns to previous mode. UP/DOWN scrolls the result area.

*   **6.6. I2C Monitor Mode (Optional - I2C-MONITOR)**
    *   **Purpose:** Direct interaction with the I2C bus for debugging/testing external hardware.
    *   **Layout:** Could allow entering device address, register address, data to write. Display scan results or read data.
    *   **Navigation:** Requires careful key mapping for hex input, read/write commands.

**7. Keyboard Interaction**

*   **Text Entry:** Requires mapping alphabet keys (likely via ALPHA modifier) and common Python symbols (`=`, `(`, `)`, `[`, `]`, `{`, `}`, `"`, `'`, `:`, `_`, `.`, `,`) often using SHIFT/FN modifiers.
*   **Indentation (Scripting):** Simulating indentation might require dedicated keys (INDENT/DEDENT) or context-aware behavior (auto-indent after ':'). This is complex via matrix keyboard.
*   **Modifiers:** Clear visual indication in the status bar when SHIFT, FN, ALPHA are active (latched or momentary?).
*   **Key Rollover/Debouncing:** Handled by `keyboard_manager`.

**8. Navigation Flow**

*   **MODE Key:** Primary method for cycling through major operational modes (CALC -> SCRIPT -> FILE -> NETWORK/API -> I2C -> CALC...). Sequence TBD.
*   **ENTER/OK Key:** Confirms selections, executes actions (calculate, run script, submit API query, select file).
*   **ESC/BACK Key:** Cancels current operation, goes back in menus/modes, clears prompts.
*   **UP/DOWN Keys:** Used for scrolling lists (scripts, files, results) and navigating menus/selections.
*   **LEFT/RIGHT Keys:** Used for cursor movement within input lines/editor.
